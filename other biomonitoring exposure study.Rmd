---
title: "other biomonitoring exposure study"
author: "En-Hsuan Lu"
date: "2023-06-03"
output: html_document
---

#Martins et al. (2019) exposure
use published data and data digitizer

```{r random}
set.seed(1234)
#Median: 0.209*0.64=0.13376 ug/kg-d
#P95: 1.584*0.64=1.01376 ug/kg-d
#P95/P50=7.578947
#GM: 0.13376; GSD: 7.578947^(1/1.96)=2.810477
exp <- rlnorm(10000,meanlog = log(0.13376), sdlog=log(2.810477))

library(readr)
don <- read.csv("DON Martins et al. 2019.csv")
don$HQER <- don$PDI * 0.64
donexp <- quantile(don$HQER, prob=c(0.5,0.95))
#Median: 0.1370751 ug/kg-d
#P95: 1.0438975 ug/kg-d
#P95/P50=7.615515
#GM: 0.1370751; GSD: 7.615515^(1/1.96)=2.817387
exp_digitizer <- rlnorm(10000,meanlog = log(0.1370751), sdlog=log(2.817387))
```


#European population; Serum concentration

```{r random}
set.seed(1234)
#Ruyck et al. 2020
#European population

#38 detected from 268 samples
#Q1: 70.4 ng/L = 0.0000704 mg/L
#Q3: 431 ng/L = 0.000431 mg/L
#GM: (0.0000704*0.000431)^(1/2) = 0.0001741907
#GSD: (0.000431/0.0000704)^(1/(qnorm(0.75)-qnorm(0.25))) = 3.831186
serum_exp <- rlnorm(10000, meanlog = log(0.0001741907), sdlog = log(3.831186))
quantile(serum_exp, prob=c(0.5, 0.05, 0.95))

#full distribution
#detections: 14.1%
#ln(x)= u + Z*sigma
#Convert Median in detections to the full distribution:
#14.1%/2= 7.05%
#100%-7.05% = 92.95%
#Convert Q3 in detections to the full distribution:
#7.05%/2= 3.525%
#100%-3.525% = 96.475%

#223 ng/L = 0.000223 mg/L
#431 ng/L = 0.000431 mg/L
#ln(0.000223) = u + Z(92.95%)*sigma; Z(92.95%)=1.47
#ln(0.000431) = u + Z(96.475%)*sigma; Z(96.475%)=1.81
#u=-4.349516; sigma=1.938049
#GM: exp(u)=exp(-11.25727)=1.291308e-05
#GSD: exp(sigma)=exp(1.93805)=6.945195
serum_expfull <- rlnorm(10000, meanlog = log(1.291308e-05), sdlog = log(6.945195))
quantile(serum_expfull, prob=c(0.5, 0.05, 0.95))
```

#European population; Urinary concentration

```{r random}
set.seed(1234)
#Ruyck et al. 2020
#European population

#convert ng/L to mg/kg-d
#assume daily urine volume as 2L
#Body weight: Crispim et al., 2011
#(81.1*63+85.7*58+78.1*54+83.8*59+85.7*62+67.6*60+66.8*60+60.6*59+71.4*62+68.4*62)/599=74.89466 kg
#1 ng/L = 0.000002 mg/74.89466 kg-d = 2.670417e-08 mg/kg-d

#Q1:224 ng/L = 5.981734e-06 mg/kg-d
#Q3: 3700 ng/L = 9.880543e-05 mg/kg-d
#GM: (5.981734e-06*9.880543e-05)^(1/2) = 2.431106e-05
#GSD: (9.880543e-05/5.981734e-06)^(1/(qnorm(0.75)-qnorm(0.25))) = 7.995957
eu.urine_exp <- rlnorm(10000, meanlog = log(2.431106e-05), sdlog = log(7.995957))
quantile(eu.urine_exp, prob=c(0.5, 0.05, 0.95))

#Detections: 24.5%
#Convert Median in detections to the full distribution:
#24.5%/2=12.25%
#100%-12.25% = 87.75%
#Convert Q3 in detections to the full distribution:
#12.25%/2=6.125%
#100%-6.125%=93.875%

#Median of detections: 494 ng/L = 1.319186e-05 mg/kg-d
#Q3 of detections: 3700 ng/L = 9.880543e-05 mg/kg-d
#ln(1.319186e-05) = u + Z(87.75%)*sigma; Z(87.75%)=1.16
#ln(9.880543e-05) = u + Z(93.875%)*sigma; Z(93.875%)=1.54
#u=-17.38254; sigma=5.298821
#GM: exp(u)=exp(-17.38254)= 2.823962e-08
#GSD: exp(sigma)=exp(5.298821)=200.1008
urine_expfull <- rlnorm(10000, meanlog = log(2.823962e-08), sdlog = log(200.1008))
quantile(urine_expfull, prob=c(0.5, 0.05, 0.95))
```

#Chinese population (Nanjing); Urinary concentration

```{r random}
set.seed(1234)
#Fan et al. 2019
#European population

#convert ug/L to mg/kg-d
#assume daily urine volume as 2L
#Body weight: 70 kg
#1 ug/L = 0.002 mg/70 kg-d = 2.857143e-05 mg/kg-d

#incidence = 10%
#mean: 4.22 ug/L; SD: 2.74 ug/L
#Q1: mean-0.675*SD = 4.22-0.675*2.74 = 2.3705 ug/L = 6.772857e-05 mg/kg-d
#Q3: mean+0.675*SD = 4.22+0.675*2.74 = 6.0695 ug/L = 0.0001734143 mg/kg-d
#convert to full distribution
#Q1>> 100-7.5=92.5%
#Q3>> 100-2.5=97.5%
#ln(6.772857e-05) = u + Z(92.5%)*sigma; Z(92.5%)=1.44
#ln(0.0001734143) = u + Z(97.5%)*sigma; Z(97.5%)=1.96
#u=-12.20356; sigma=1.808029
#GM: exp(u)=exp(-12.20356)= 5.012579e-06
#GSD: exp(sigma)=exp(1.808029)= 6.098416
urine_chinj <- rlnorm(10000, meanlog = log(5.012579e-06), sdlog = log(6.098416))
quantile(urine_chinj, prob=c(0.5, 0.05, 0.95))
```

#Chinese population (Nanjing); Plasma concentration

```{r random}
set.seed(1234)
#Fan et al. 2019
#European population

#convert ug/L to mg/L
#1 ug/L = 0.001 mg/L

#incidence = 2.3%
#mean: 2.6 ug/L; SD: 1.53 ug/L
#Q1: mean-0.675*SD = 2.6-0.675*1.53 = 1.56725 ug/L = 0.00156725 mg/L
#Q3: mean+0.675*SD = 2.6+0.675*1.53 = 3.63275 ug/L = 0.00363275 mg/L
#convert to full distribution
#Q1>> 100-1.725=98.275%
#Q3>> 100-0.575=99.425%
#ln(0.00156725) = u + Z(98.275%)*sigma; Z(98.275%)=2.11
#ln(0.00363275) = u + Z(99.425%)*sigma; Z(99.425%)=2.53
#u=-10.68179; sigma=2.00159
#GM: exp(u)=exp(-10.68179)= 2.295924e-05
#GSD: exp(sigma)=exp(2.00159)= 7.400814
plasma_chinj <- rlnorm(10000, meanlog = log(2.295924e-05), sdlog = log(7.400814))
quantile(plasma_chinj, prob=c(0.5, 0.05, 0.95))
```

### European population random sample; urine (full distribution)
Ruyck et al. 2020

```{r random}
set.seed(1234)

eu_ue <- rlnorm(10000, meanlog = log(2.823962e-08), sdlog = log(200.1008))

yran<-numeric() # blank 
npop <- length(eu_ue)
zrand <- rnorm(npop) # npop random individuals
for (j in 1:length(eu_ue)) {
  y<-numeric() # blank 
  #for (k in 1:npop) {
    z_i <- zrand[j]
    AED <- (eu_ue[j] * BE.urine.df$AF_interTD * ((BE.urine.df$Intra.GSD)^z_i))/(BE.urine.df$Cavg_dose_a*BE.urine.df$U_Cavg_h.GM)
    
    #model weight
    w_k_female <- c(0.271, 0.077, 0.216, 0.052, 0.058, 0.031, 0.174, 0.12)
    w_k_female <- w_k_female/sum(w_k_female) # Make sure adds up to 1
    w_k_female_cum <- cumsum(w_k_female) # Cumulative
    w_k_male <- c(0.224, 0.12, 0.09, 0.064, 0.065, 0.11, 0.058, 0.27)
    w_k_male <- w_k_male/sum(w_k_male) # Make sure adds up to 1
    w_k_male_cum <- cumsum(w_k_male) # Cumulative
    
    w_k5000_female_cum <- c(0,round(5000*w_k_female_cum)) # start/end index numbers
    w_k5000_male_cum <- 5000+c(0,round(5000*w_k_male_cum)) # start/end index numbers
    
    w_k5000_female <- diff(w_k5000_female_cum) # Difference is size
    w_k5000_male <- diff(w_k5000_male_cum) # Difference is size
    
    samp.parms.1 <- female_mice[sample(c(1:15000), size=w_k5000_female[1]),]
    samp.parms.2 <- female_mice[sample(c(15001:30000), size=w_k5000_female[2]),]
    samp.parms.3 <- female_mice[sample(c(30001:45000), size=w_k5000_female[3]),]
    samp.parms.4 <- female_mice[sample(c(45001:60000), size=w_k5000_female[4]),]
    samp.parms.5 <- female_mice[sample(c(60001:75000), size=w_k5000_female[5]),]
    samp.parms.6 <- female_mice[sample(c(75001:90000), size=w_k5000_female[6]),]
    samp.parms.7 <- female_mice[sample(c(90001:105000), size=w_k5000_female[7]),]
    samp.parms.8 <- female_mice[sample(c(105001:120000), size=w_k5000_female[8]),]
    
    # Use subsamples of AED
    y_female <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_female_cum[1]):w_k5000_female_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_female_cum[2]):w_k5000_female_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_female_cum[3]):w_k5000_female_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_female_cum[4]):w_k5000_female_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_female_cum[5]):w_k5000_female_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_female_cum[6]):w_k5000_female_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_female_cum[7]):w_k5000_female_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_female_cum[8]):w_k5000_female_cum[9]])
    )
    
    samp.parms.1 <- male_mice[sample(c(1:15000), size=w_k5000_male[1]),]
    samp.parms.2 <- male_mice[sample(c(15001:30000), size=w_k5000_male[2]),]
    samp.parms.3 <- male_mice[sample(c(30001:45000), size=w_k5000_male[3]),]
    samp.parms.4 <- male_mice[sample(c(45001:60000), size=w_k5000_male[4]),]
    samp.parms.5 <- male_mice[sample(c(60001:75000), size=w_k5000_male[5]),]
    samp.parms.6 <- male_mice[sample(c(75001:90000), size=w_k5000_male[6]),]
    samp.parms.7 <- male_mice[sample(c(90001:105000), size=w_k5000_male[7]),]
    samp.parms.8 <- male_mice[sample(c(105001:120000), size=w_k5000_male[8]),]
    
    y_male <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_male_cum[1]):w_k5000_male_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_male_cum[2]):w_k5000_male_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_male_cum[3]):w_k5000_male_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_male_cum[4]):w_k5000_male_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_male_cum[5]):w_k5000_male_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_male_cum[6]):w_k5000_male_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_male_cum[7]):w_k5000_male_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_male_cum[8]):w_k5000_male_cum[9]])
    )
    y <- c(y_female,y_male)
  yran <- cbind(yran,y)
}
yran<-as.data.frame(yran)
names(yran) <- paste("eu_ue",1:length(eu_ue),sep=".")

yranpop <- as.data.frame(apply(yran, 1, sample, size=1))
colnames(yranpop) <- "random"

ymean <- as.data.frame(apply(yran,1,mean))
colnames(ymean) <- "mean"

y1perc <- as.data.frame(apply(yran,1,quantile,prob=0.01))
colnames(y1perc) <- "1%pop"

y5perc <- as.data.frame(apply(yran,1,quantile,prob=0.05))
colnames(y5perc) <- "5%pop"

ymed <- as.data.frame(apply(yran,1,quantile,prob=0.5))
colnames(ymed) <- "50%pop"

y95perc <- as.data.frame(apply(yran,1,quantile,prob=0.95))
colnames(y95perc) <- "95%pop"

y99perc <- as.data.frame(apply(yran,1,quantile,prob=0.99))
colnames(y99perc) <- "99%pop"

yran.df <- cbind(yranpop, ymean, y1perc, y5perc, ymed, y95perc, y99perc)
write.csv(yran.df, file="Perc European population UE fraction of response.csv", row.names=FALSE)
```


### European population random sample; serum (full distribution)
Ruyck et al. 2020

```{r random}
set.seed(1234)

eu_fullse <- rlnorm(10000, meanlog = log(1.291308e-05), sdlog = log(6.945195))

yran<-numeric() # blank 
npop <- length(eu_fullse)
zrand <- rnorm(npop) # npop random individuals
for (j in 1:length(eu_fullse)) {
  y<-numeric() # blank 
  #for (k in 1:npop) {
    z_i <- zrand[j]
    AED <- (eu_fullse[j] * BE.blood.df$AF_interTD * (BE.blood.df$TD_var.GSD^z_i))/(BE.blood.df$Cavg_dose_a)
    
    #model weight
    w_k_female <- c(0.271, 0.077, 0.216, 0.052, 0.058, 0.031, 0.174, 0.12)
    w_k_female <- w_k_female/sum(w_k_female) # Make sure adds up to 1
    w_k_female_cum <- cumsum(w_k_female) # Cumulative
    w_k_male <- c(0.224, 0.12, 0.09, 0.064, 0.065, 0.11, 0.058, 0.27)
    w_k_male <- w_k_male/sum(w_k_male) # Make sure adds up to 1
    w_k_male_cum <- cumsum(w_k_male) # Cumulative
    
    w_k5000_female_cum <- c(0,round(5000*w_k_female_cum)) # start/end index numbers
    w_k5000_male_cum <- 5000+c(0,round(5000*w_k_male_cum)) # start/end index numbers
    
    w_k5000_female <- diff(w_k5000_female_cum) # Difference is size
    w_k5000_male <- diff(w_k5000_male_cum) # Difference is size
    
    samp.parms.1 <- female_mice[sample(c(1:15000), size=w_k5000_female[1]),]
    samp.parms.2 <- female_mice[sample(c(15001:30000), size=w_k5000_female[2]),]
    samp.parms.3 <- female_mice[sample(c(30001:45000), size=w_k5000_female[3]),]
    samp.parms.4 <- female_mice[sample(c(45001:60000), size=w_k5000_female[4]),]
    samp.parms.5 <- female_mice[sample(c(60001:75000), size=w_k5000_female[5]),]
    samp.parms.6 <- female_mice[sample(c(75001:90000), size=w_k5000_female[6]),]
    samp.parms.7 <- female_mice[sample(c(90001:105000), size=w_k5000_female[7]),]
    samp.parms.8 <- female_mice[sample(c(105001:120000), size=w_k5000_female[8]),]
    
    # Use subsamples of AED
    y_female <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_female_cum[1]):w_k5000_female_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_female_cum[2]):w_k5000_female_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_female_cum[3]):w_k5000_female_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_female_cum[4]):w_k5000_female_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_female_cum[5]):w_k5000_female_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_female_cum[6]):w_k5000_female_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_female_cum[7]):w_k5000_female_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_female_cum[8]):w_k5000_female_cum[9]])
    )
    
    samp.parms.1 <- male_mice[sample(c(1:15000), size=w_k5000_male[1]),]
    samp.parms.2 <- male_mice[sample(c(15001:30000), size=w_k5000_male[2]),]
    samp.parms.3 <- male_mice[sample(c(30001:45000), size=w_k5000_male[3]),]
    samp.parms.4 <- male_mice[sample(c(45001:60000), size=w_k5000_male[4]),]
    samp.parms.5 <- male_mice[sample(c(60001:75000), size=w_k5000_male[5]),]
    samp.parms.6 <- male_mice[sample(c(75001:90000), size=w_k5000_male[6]),]
    samp.parms.7 <- male_mice[sample(c(90001:105000), size=w_k5000_male[7]),]
    samp.parms.8 <- male_mice[sample(c(105001:120000), size=w_k5000_male[8]),]
    
    y_male <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_male_cum[1]):w_k5000_male_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_male_cum[2]):w_k5000_male_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_male_cum[3]):w_k5000_male_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_male_cum[4]):w_k5000_male_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_male_cum[5]):w_k5000_male_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_male_cum[6]):w_k5000_male_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_male_cum[7]):w_k5000_male_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_male_cum[8]):w_k5000_male_cum[9]])
    )
    y <- c(y_female,y_male)
  yran <- cbind(yran,y)
}
yran<-as.data.frame(yran)
names(yran) <- paste("Eu_fullse",1:length(eu_fullse),sep=".")

yranpop <- as.data.frame(apply(yran, 1, sample, size=1))
colnames(yranpop) <- "random"

ymean <- as.data.frame(apply(yran,1,mean))
colnames(ymean) <- "mean"

y1perc <- as.data.frame(apply(yran,1,quantile,prob=0.01))
colnames(y1perc) <- "1%pop"

y5perc <- as.data.frame(apply(yran,1,quantile,prob=0.05))
colnames(y5perc) <- "5%pop"

ymed <- as.data.frame(apply(yran,1,quantile,prob=0.5))
colnames(ymed) <- "50%pop"

y95perc <- as.data.frame(apply(yran,1,quantile,prob=0.95))
colnames(y95perc) <- "95%pop"

y99perc <- as.data.frame(apply(yran,1,quantile,prob=0.99))
colnames(y99perc) <- "99%pop"

yran.df <- cbind(yranpop, ymean, y1perc, y5perc, ymed, y95perc, y99perc)
write.csv(yran.df, file="Perc European population full distribution serum fraction of response.csv", row.names=FALSE)
```

### European population random sample; detected serum
Ruyck et al. 2020

```{r random}
set.seed(1234)

eu_se <- rlnorm(10000, meanlog = log(0.0001741907), sdlog = log(3.831186))

yran<-numeric() # blank 
npop <- length(eu_se)
zrand <- rnorm(npop) # npop random individuals
for (j in 1:length(eu_se)) {
  y<-numeric() # blank 
  #for (k in 1:npop) {
    z_i <- zrand[j]
    AED <- (eu_se[j] * BE.blood.df$AF_interTD * (BE.blood.df$TD_var.GSD^z_i))/(BE.blood.df$Cavg_dose_a)
    
    #model weight
    w_k_female <- c(0.271, 0.077, 0.216, 0.052, 0.058, 0.031, 0.174, 0.12)
    w_k_female <- w_k_female/sum(w_k_female) # Make sure adds up to 1
    w_k_female_cum <- cumsum(w_k_female) # Cumulative
    w_k_male <- c(0.224, 0.12, 0.09, 0.064, 0.065, 0.11, 0.058, 0.27)
    w_k_male <- w_k_male/sum(w_k_male) # Make sure adds up to 1
    w_k_male_cum <- cumsum(w_k_male) # Cumulative
    
    w_k5000_female_cum <- c(0,round(5000*w_k_female_cum)) # start/end index numbers
    w_k5000_male_cum <- 5000+c(0,round(5000*w_k_male_cum)) # start/end index numbers
    
    w_k5000_female <- diff(w_k5000_female_cum) # Difference is size
    w_k5000_male <- diff(w_k5000_male_cum) # Difference is size
    
    samp.parms.1 <- female_mice[sample(c(1:15000), size=w_k5000_female[1]),]
    samp.parms.2 <- female_mice[sample(c(15001:30000), size=w_k5000_female[2]),]
    samp.parms.3 <- female_mice[sample(c(30001:45000), size=w_k5000_female[3]),]
    samp.parms.4 <- female_mice[sample(c(45001:60000), size=w_k5000_female[4]),]
    samp.parms.5 <- female_mice[sample(c(60001:75000), size=w_k5000_female[5]),]
    samp.parms.6 <- female_mice[sample(c(75001:90000), size=w_k5000_female[6]),]
    samp.parms.7 <- female_mice[sample(c(90001:105000), size=w_k5000_female[7]),]
    samp.parms.8 <- female_mice[sample(c(105001:120000), size=w_k5000_female[8]),]
    
    # Use subsamples of AED
    y_female <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_female_cum[1]):w_k5000_female_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_female_cum[2]):w_k5000_female_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_female_cum[3]):w_k5000_female_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_female_cum[4]):w_k5000_female_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_female_cum[5]):w_k5000_female_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_female_cum[6]):w_k5000_female_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_female_cum[7]):w_k5000_female_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_female_cum[8]):w_k5000_female_cum[9]])
    )
    
    samp.parms.1 <- male_mice[sample(c(1:15000), size=w_k5000_male[1]),]
    samp.parms.2 <- male_mice[sample(c(15001:30000), size=w_k5000_male[2]),]
    samp.parms.3 <- male_mice[sample(c(30001:45000), size=w_k5000_male[3]),]
    samp.parms.4 <- male_mice[sample(c(45001:60000), size=w_k5000_male[4]),]
    samp.parms.5 <- male_mice[sample(c(60001:75000), size=w_k5000_male[5]),]
    samp.parms.6 <- male_mice[sample(c(75001:90000), size=w_k5000_male[6]),]
    samp.parms.7 <- male_mice[sample(c(90001:105000), size=w_k5000_male[7]),]
    samp.parms.8 <- male_mice[sample(c(105001:120000), size=w_k5000_male[8]),]
    
    y_male <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_male_cum[1]):w_k5000_male_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_male_cum[2]):w_k5000_male_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_male_cum[3]):w_k5000_male_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_male_cum[4]):w_k5000_male_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_male_cum[5]):w_k5000_male_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_male_cum[6]):w_k5000_male_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_male_cum[7]):w_k5000_male_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_male_cum[8]):w_k5000_male_cum[9]])
    )
    y <- c(y_female,y_male)
  yran <- cbind(yran,y)
}
yran<-as.data.frame(yran)
names(yran) <- paste("Eu_se",1:length(eu_se),sep=".")

yranpop <- as.data.frame(apply(yran, 1, sample, size=1))
colnames(yranpop) <- "random"

ymean <- as.data.frame(apply(yran,1,mean))
colnames(ymean) <- "mean"

y1perc <- as.data.frame(apply(yran,1,quantile,prob=0.01))
colnames(y1perc) <- "1%pop"

ymed <- as.data.frame(apply(yran,1,quantile,prob=0.5))
colnames(ymed) <- "50%pop"

y99perc <- as.data.frame(apply(yran,1,quantile,prob=0.99))
colnames(y99perc) <- "99%pop"

yran.df <- cbind(yranpop, ymean, y1perc, ymed, y99perc)
write.csv(yran.df, file="Perc European population detected serum fraction of response.csv", row.names=FALSE)
```

### Chinese Nanjing population; urine (full distribution)
Fan et al. 2019

```{r random}
set.seed(1234)

chnj_ue <- rlnorm(10000, meanlog = log(5.012579e-06), sdlog = log(6.098416))

yran<-numeric() # blank 
npop <- length(chnj_ue)
zrand <- rnorm(npop) # npop random individuals
for (j in 1:length(chnj_ue)) {
  y<-numeric() # blank 
  #for (k in 1:npop) {
    z_i <- zrand[j]
    AED <- (chnj_ue[j] * BE.urine.df$AF_interTD * ((BE.urine.df$Intra.GSD)^z_i))/(BE.urine.df$Cavg_dose_a*BE.urine.df$U_Cavg_h.GM)
    
    #model weight
    w_k_female <- c(0.271, 0.077, 0.216, 0.052, 0.058, 0.031, 0.174, 0.12)
    w_k_female <- w_k_female/sum(w_k_female) # Make sure adds up to 1
    w_k_female_cum <- cumsum(w_k_female) # Cumulative
    w_k_male <- c(0.224, 0.12, 0.09, 0.064, 0.065, 0.11, 0.058, 0.27)
    w_k_male <- w_k_male/sum(w_k_male) # Make sure adds up to 1
    w_k_male_cum <- cumsum(w_k_male) # Cumulative
    
    w_k5000_female_cum <- c(0,round(5000*w_k_female_cum)) # start/end index numbers
    w_k5000_male_cum <- 5000+c(0,round(5000*w_k_male_cum)) # start/end index numbers
    
    w_k5000_female <- diff(w_k5000_female_cum) # Difference is size
    w_k5000_male <- diff(w_k5000_male_cum) # Difference is size
    
    samp.parms.1 <- female_mice[sample(c(1:15000), size=w_k5000_female[1]),]
    samp.parms.2 <- female_mice[sample(c(15001:30000), size=w_k5000_female[2]),]
    samp.parms.3 <- female_mice[sample(c(30001:45000), size=w_k5000_female[3]),]
    samp.parms.4 <- female_mice[sample(c(45001:60000), size=w_k5000_female[4]),]
    samp.parms.5 <- female_mice[sample(c(60001:75000), size=w_k5000_female[5]),]
    samp.parms.6 <- female_mice[sample(c(75001:90000), size=w_k5000_female[6]),]
    samp.parms.7 <- female_mice[sample(c(90001:105000), size=w_k5000_female[7]),]
    samp.parms.8 <- female_mice[sample(c(105001:120000), size=w_k5000_female[8]),]
    
    # Use subsamples of AED
    y_female <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_female_cum[1]):w_k5000_female_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_female_cum[2]):w_k5000_female_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_female_cum[3]):w_k5000_female_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_female_cum[4]):w_k5000_female_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_female_cum[5]):w_k5000_female_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_female_cum[6]):w_k5000_female_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_female_cum[7]):w_k5000_female_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_female_cum[8]):w_k5000_female_cum[9]])
    )
    
    samp.parms.1 <- male_mice[sample(c(1:15000), size=w_k5000_male[1]),]
    samp.parms.2 <- male_mice[sample(c(15001:30000), size=w_k5000_male[2]),]
    samp.parms.3 <- male_mice[sample(c(30001:45000), size=w_k5000_male[3]),]
    samp.parms.4 <- male_mice[sample(c(45001:60000), size=w_k5000_male[4]),]
    samp.parms.5 <- male_mice[sample(c(60001:75000), size=w_k5000_male[5]),]
    samp.parms.6 <- male_mice[sample(c(75001:90000), size=w_k5000_male[6]),]
    samp.parms.7 <- male_mice[sample(c(90001:105000), size=w_k5000_male[7]),]
    samp.parms.8 <- male_mice[sample(c(105001:120000), size=w_k5000_male[8]),]
    
    y_male <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_male_cum[1]):w_k5000_male_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_male_cum[2]):w_k5000_male_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_male_cum[3]):w_k5000_male_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_male_cum[4]):w_k5000_male_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_male_cum[5]):w_k5000_male_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_male_cum[6]):w_k5000_male_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_male_cum[7]):w_k5000_male_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_male_cum[8]):w_k5000_male_cum[9]])
    )
    y <- c(y_female,y_male)
  yran <- cbind(yran,y)
}
yran<-as.data.frame(yran)
names(yran) <- paste("chnj_ue",1:length(chnj_ue),sep=".")

yranpop <- as.data.frame(apply(yran, 1, sample, size=1))
colnames(yranpop) <- "random"

ymean <- as.data.frame(apply(yran,1,mean))
colnames(ymean) <- "mean"

y1perc <- as.data.frame(apply(yran,1,quantile,prob=0.01))
colnames(y1perc) <- "1%pop"

y5perc <- as.data.frame(apply(yran,1,quantile,prob=0.05))
colnames(y5perc) <- "5%pop"

ymed <- as.data.frame(apply(yran,1,quantile,prob=0.5))
colnames(ymed) <- "50%pop"

y95perc <- as.data.frame(apply(yran,1,quantile,prob=0.95))
colnames(y95perc) <- "95%pop"

y99perc <- as.data.frame(apply(yran,1,quantile,prob=0.99))
colnames(y99perc) <- "99%pop"

yran.df <- cbind(yranpop, ymean, y1perc, y5perc, ymed, y95perc, y99perc)
write.csv(yran.df, file="Perc Chinese Nanjing population UE fraction of response.csv", row.names=FALSE)
```

### Chinese Nanjing population; plasma (full distribution)
Fan et al. 2019

```{r random}
set.seed(1234)

chnj_pla <- rlnorm(10000, meanlog = log(2.295924e-05), sdlog = log(7.400814))

yran<-numeric() # blank 
npop <- length(chnj_pla)
zrand <- rnorm(npop) # npop random individuals
for (j in 1:length(chnj_pla)) {
  y<-numeric() # blank 
  #for (k in 1:npop) {
    z_i <- zrand[j]
    AED <- (chnj_pla[j] * BE.blood.df$AF_interTD * (BE.blood.df$TD_var.GSD^z_i))/(BE.blood.df$Cavg_dose_a)
    
    #model weight
    w_k_female <- c(0.271, 0.077, 0.216, 0.052, 0.058, 0.031, 0.174, 0.12)
    w_k_female <- w_k_female/sum(w_k_female) # Make sure adds up to 1
    w_k_female_cum <- cumsum(w_k_female) # Cumulative
    w_k_male <- c(0.224, 0.12, 0.09, 0.064, 0.065, 0.11, 0.058, 0.27)
    w_k_male <- w_k_male/sum(w_k_male) # Make sure adds up to 1
    w_k_male_cum <- cumsum(w_k_male) # Cumulative
    
    w_k5000_female_cum <- c(0,round(5000*w_k_female_cum)) # start/end index numbers
    w_k5000_male_cum <- 5000+c(0,round(5000*w_k_male_cum)) # start/end index numbers
    
    w_k5000_female <- diff(w_k5000_female_cum) # Difference is size
    w_k5000_male <- diff(w_k5000_male_cum) # Difference is size
    
    samp.parms.1 <- female_mice[sample(c(1:15000), size=w_k5000_female[1]),]
    samp.parms.2 <- female_mice[sample(c(15001:30000), size=w_k5000_female[2]),]
    samp.parms.3 <- female_mice[sample(c(30001:45000), size=w_k5000_female[3]),]
    samp.parms.4 <- female_mice[sample(c(45001:60000), size=w_k5000_female[4]),]
    samp.parms.5 <- female_mice[sample(c(60001:75000), size=w_k5000_female[5]),]
    samp.parms.6 <- female_mice[sample(c(75001:90000), size=w_k5000_female[6]),]
    samp.parms.7 <- female_mice[sample(c(90001:105000), size=w_k5000_female[7]),]
    samp.parms.8 <- female_mice[sample(c(105001:120000), size=w_k5000_female[8]),]
    
    # Use subsamples of AED
    y_female <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_female_cum[1]):w_k5000_female_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_female_cum[2]):w_k5000_female_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_female_cum[3]):w_k5000_female_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_female_cum[4]):w_k5000_female_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_female_cum[5]):w_k5000_female_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_female_cum[6]):w_k5000_female_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_female_cum[7]):w_k5000_female_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_female_cum[8]):w_k5000_female_cum[9]])
    )
    
    samp.parms.1 <- male_mice[sample(c(1:15000), size=w_k5000_male[1]),]
    samp.parms.2 <- male_mice[sample(c(15001:30000), size=w_k5000_male[2]),]
    samp.parms.3 <- male_mice[sample(c(30001:45000), size=w_k5000_male[3]),]
    samp.parms.4 <- male_mice[sample(c(45001:60000), size=w_k5000_male[4]),]
    samp.parms.5 <- male_mice[sample(c(60001:75000), size=w_k5000_male[5]),]
    samp.parms.6 <- male_mice[sample(c(75001:90000), size=w_k5000_male[6]),]
    samp.parms.7 <- male_mice[sample(c(90001:105000), size=w_k5000_male[7]),]
    samp.parms.8 <- male_mice[sample(c(105001:120000), size=w_k5000_male[8]),]
    
    y_male <- c(
      frachange.1(a=samp.parms.1$a, b=samp.parms.1$b, dose=AED[(1+w_k5000_male_cum[1]):w_k5000_male_cum[2]])
      ,frachange.2(a=samp.parms.2$a, b=samp.parms.2$b, g=samp.parms.2$g, dose=AED[(1+w_k5000_male_cum[2]):w_k5000_male_cum[3]])
      ,frachange.3(a=samp.parms.3$a, b=samp.parms.3$b, c=samp.parms.3$c, dose=AED[(1+w_k5000_male_cum[3]):w_k5000_male_cum[4]])
      ,frachange.4(a=samp.parms.4$a, b=samp.parms.4$b, c=samp.parms.4$c, g=samp.parms.4$g, dose=AED[(1+w_k5000_male_cum[4]):w_k5000_male_cum[5]])
      ,frachange.5(a=samp.parms.5$a, b=samp.parms.5$b, c=samp.parms.5$c, g=samp.parms.5$g, dose=AED[(1+w_k5000_male_cum[5]):w_k5000_male_cum[6]])
      ,frachange.6(a=samp.parms.6$a, b=samp.parms.6$b, g=samp.parms.6$g, dose=AED[(1+w_k5000_male_cum[6]):w_k5000_male_cum[7]])
      ,frachange.7(a=samp.parms.7$a, b=samp.parms.7$b, c=samp.parms.7$c, dose=AED[(1+w_k5000_male_cum[7]):w_k5000_male_cum[8]])
      ,frachange.8(a=samp.parms.8$a, b=samp.parms.8$b, dose=AED[(1+w_k5000_male_cum[8]):w_k5000_male_cum[9]])
    )
    y <- c(y_female,y_male)
  yran <- cbind(yran,y)
}
yran<-as.data.frame(yran)
names(yran) <- paste("chnj_pla",1:length(chnj_pla),sep=".")

yranpop <- as.data.frame(apply(yran, 1, sample, size=1))
colnames(yranpop) <- "random"

ymean <- as.data.frame(apply(yran,1,mean))
colnames(ymean) <- "mean"

y1perc <- as.data.frame(apply(yran,1,quantile,prob=0.01))
colnames(y1perc) <- "1%pop"

y5perc <- as.data.frame(apply(yran,1,quantile,prob=0.05))
colnames(y5perc) <- "5%pop"

ymed <- as.data.frame(apply(yran,1,quantile,prob=0.5))
colnames(ymed) <- "50%pop"

y95perc <- as.data.frame(apply(yran,1,quantile,prob=0.95))
colnames(y95perc) <- "95%pop"

y99perc <- as.data.frame(apply(yran,1,quantile,prob=0.99))
colnames(y99perc) <- "99%pop"

yran.df <- cbind(yranpop, ymean, y1perc, y5perc, ymed, y95perc, y99perc)
write.csv(yran.df, file="Perc Chinese Nanjing population plasma fraction of response.csv", row.names=FALSE)
```

#quantile

```{r quantile}
###European
yran.df.eu <- read.csv("Perc European population UE fraction of response.csv")
quan.eu <- apply(yran.df.eu, 2, quantile, prob=c(0.5, 0.05, 0.95))
write.csv(quan.eu, file="Quantiles of European population UE fraction of response.csv")

yran.df.euserum <- read.csv("Perc European population full distribution serum fraction of response.csv")
quan.euserum <- apply(yran.df.euserum, 2, quantile, prob=c(0.5, 0.05, 0.95))
write.csv(quan.euserum, file="Quantiles of European population serum fraction of response.csv")

##Chinese Nanjing
yran.df.chnj <- read.csv("Perc Chinese Nanjing population UE fraction of response.csv")
quan.chnj <- apply(yran.df.chnj, 2, quantile, prob=c(0.5, 0.05, 0.95))
write.csv(quan.chnj, file="Quantiles of Chinese Nanjing population UE fraction of response.csv")

yran.df.chnjplasma <- read.csv("Perc Chinese Nanjing population plasma fraction of response.csv")
quan.chnjplasma <- apply(yran.df.chnjplasma, 2, quantile, prob=c(0.5, 0.05, 0.95))
write.csv(quan.chnjplasma, file="Quantiles of Chinese Nanjing population plasma fraction of response.csv")
```

##boxplot

```{r ggplot}
###European urine
yran.df.eu <- read.csv("Perc European population UE fraction of response.csv")
melt.yran.eu <- melt(yran.df.eu[,1:7])

expboxplot.eu <- ggplot(melt.yran.eu, aes(x=value, y=variable))+
  geom_boxplot(aes(fill=variable),
               outlier.shape=NA,
               show.legend = FALSE)+
  scale_x_continuous(limits=c(-0.1,0), breaks = c(-0.10,-0.05, 0), labels = c("-10%","-5%","0"))+
  scale_y_discrete(limits=rev, labels = c("population 99%","population 95%","population median","population 5%","populaion 1%","population mean","random individual"))+
  theme_bw()+
  xlab("fraction of response (% BW change)")+
  theme(axis.title.y = element_blank())+
  geom_vline(xintercept = -0.05, linetype="dashed", color="red")

ggsave(expboxplot.eu, file="Boxplot European population UE Fraction of response.pdf", width=8, height=10)

###European serum
yran.df.euserum <- read.csv("Perc European population full distribution serum fraction of response.csv")
melt.yran.euserum <- melt(yran.df.euserum[,1:7])

expboxplot.euserum <- ggplot(melt.yran.euserum, aes(x=value, y=variable))+
  geom_boxplot(aes(fill=variable),
               outlier.shape=NA,
               show.legend = FALSE)+
  scale_x_continuous(limits=c(-0.1,0), breaks = c(-0.10,-0.05, 0), labels = c("-10%","-5%","0"))+
  scale_y_discrete(limits=rev, labels = c("population 99%","population 95%","population median","population 5%","populaion 1%","population mean","random individual"))+
  theme_bw()+
  xlab("fraction of response (% BW change)")+
  theme(axis.title.y = element_blank())+
  geom_vline(xintercept = -0.05, linetype="dashed", color="red")

ggsave(expboxplot.euserum, file="Boxplot European population serum Fraction of response.pdf", width=8, height=10)

###Chinese Nanjing urine
yran.df.chnj <- read.csv("Perc Chinese Nanjing population UE fraction of response.csv")
melt.yran.chnj <- melt(yran.df.chnj[,1:7])

expboxplot.chnj <- ggplot(melt.yran.chnj, aes(x=value, y=variable))+
  geom_boxplot(aes(fill=variable),
               outlier.shape=NA,
               show.legend = FALSE)+
  scale_x_continuous(limits=c(-0.1,0), breaks = c(-0.10,-0.05, 0), labels = c("-10%","-5%","0"))+
  scale_y_discrete(limits=rev, labels = c("population 99%","population 95%","population median","population 5%","populaion 1%","population mean","random individual"))+
  theme_bw()+
  xlab("fraction of response (% BW change)")+
  theme(axis.title.y = element_blank())+
  geom_vline(xintercept = -0.05, linetype="dashed", color="red")

ggsave(expboxplot.chnj, file="Boxplot Chinese Nanjing population UE Fraction of response.pdf", width=8, height=10)

###Chinese Nanjing plasma
yran.df.chnjplasma <- read.csv("Perc Chinese Nanjing population plasma fraction of response.csv")
melt.yran.chnjplasma <- melt(yran.df.chnjplasma[,1:7])

expboxplot.chnjplasma <- ggplot(melt.yran.chnjplasma, aes(x=value, y=variable))+
  geom_boxplot(aes(fill=variable),
               outlier.shape=NA,
               show.legend = FALSE)+
  scale_x_continuous(limits=c(-0.1,0), breaks = c(-0.10,-0.05, 0), labels = c("-10%","-5%","0"))+
  scale_y_discrete(limits=rev, labels = c("population 99%","population 95%","population median","population 5%","populaion 1%","population mean","random individual"))+
  theme_bw()+
  xlab("fraction of response (% BW change)")+
  theme(axis.title.y = element_blank())+
  geom_vline(xintercept = -0.05, linetype="dashed", color="red")

ggsave(expboxplot.chnjplasma, file="Boxplot Chinese Nanjing population plasma Fraction of response.pdf", width=8, height=10)

boxplot_frac <- ggarrange(expboxplot.port, expboxplot.chi, ncol=2, nrow=1,
                          labels = c("A","B"), font.label = list(size = 18))
ggsave(boxplot_frac, file="manuscript Boxplot fraction of response.pdf", width=12, height=8)
```

##compare with TDI values

```{r density}
set.seed(1234)

#European population
#Q1: 79.7 ng/kg/day = 0.0000797 mg/kg bw/day
#Q3: 274 ng/kg/day = 0.000274 mg/kg bw/day
#GM: (0.0000797*0.000274)^(1/2) = 0.0001477762 mg/kg bw/day
#GSD: (0.000274/0.0000797)^(1/(qnorm(0.75)-qnorm(0.25))) = 2.497779
intake_eu <- rlnorm(10000, meanlog = log(0.0001477762), sdlog = log(2.497779))
d_eu <- ecdf(intake_eu)
eu <- 100*c(1-d_eu(0.001), 1-d_eu(0.00044), 1-d_eu(0.00137))
eu
```